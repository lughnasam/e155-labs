/*
Name: Lughnasa Miller
Date: 10/2/25
Email: lumiller@hmc.edu
Description: main code for E155 lab 4
*/

#include "STM32L432KC_FLASH.h"
#include "STM32L432KC_GPIO.h"
#include "STM32L432KC_RCC.h"
#include "STM32L432KC_TIM.h"

// Pitch in Hz, duration in ms
const int notes[][2] = {
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	250},
{  0,	125},
{494,	125},
{523,	125},
{587,	125},
{659,	375},
{392,	125},
{699,	125},
{659,	125},
{587,	375},
{349,	125},
{659,	125},
{587,	125},
{523,	375},
{330,	125},
{587,	125},
{523,	125},
{494,	250},
{  0,	125},
{330,	125},
{659,	125},
{  0,	250},
{659,	125},
{1319,	125},
{  0,	250},
{623,	125},
{659,	125},
{  0,	250},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	500},
{  0,	0}};

int best_song[][2] = {
{494, 250},
{330, 250},
{494, 250},
{330, 250},
{494, 250},
{330, 250},
{494, 250},
{415, 250},
{330, 250},
{415, 250},
{330, 250},
{415, 250},
{330, 250},
{370, 250},
{330, 250},
{370, 250},
{494, 250},
{330, 250},
{494, 250},
{330, 250},
{494, 250},
{330, 250},
{494, 250},
{330, 250},
{494, 250},
{330, 250},
{554, 250},
{330, 250},
{294, 250},
{330, 250},
{294, 250},
{330, 250},
{294, 250},
{330, 250},
{330, 250},
{330, 250},
{415, 250},
{330, 250},
{415, 250},
{330, 250},
{415, 250},
{330, 250},
{440, 250},
{370, 250},
{330, 250},
{370, 250},
{330, 250},
{370, 250},
{330, 250},
{370, 250},
{330, 250},
{277, 250},
{220, 250},
{330, 250},
{277, 250},
{330, 250},
{277, 250},
{330, 250},
{247, 250},
{330, 250},
{247, 250},
{330, 250},
{247, 250},
{330, 250},
{247, 250},
{294, 250},
{247, 250},
{330, 250},
{494, 250}
};

int main(void) {
    // set clock to PLL (80 MHz)
    configureClock();

    // initialize timers
    initTIM(TIM16);

    // enable GPIO pin for PWM signal
    pinMode(6, GPIO_ALT);

    // enable 
    RCC->AHB2ENR |= (1 << 0);

    //enable timers clk
    RCC->APB2ENR |= (0b11 << 16);

    for(int i = 0; i < 108; i++) {
        // generate PWM
        initPWM(TIM15, notes[i][0]);

        // delay for x time
        delay_millis(TIM16, notes[i][1]);
    }
	
}
